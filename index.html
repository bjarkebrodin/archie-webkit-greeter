<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">

<html>
<head>
  <meta charset="UTF-8">
  <style>

    body {
      background-image: url('/usr/share/backgrounds/greeter/default.jpg');
      background-position: center;
      background-size: cover;
    }

    html, body {
      width: 100%;
      height: 100%;
      overflow: hidden;
      margin: 0;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .inputBox {
      width: 180px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
    }

    .inputBox * {
      transition: 1s opacity;
    }

    .inputBox img {
      margin-bottom: 3em;
    }
    
    .inputBox input,
    .inputBox button {
      border: none;
      background-color: transparent;
      color: #dddddd;
      font-family: 'Iosevka Term';
      font-size: 18px;
      text-align: center;
      margin-bottom: 1em;
    }

    .inputBox button {
      margin-top: 2em;
      color: transparent;
    }

    .inputBox input:active,
    .inputBox input:focus,
    .inputBox input::selection,
    .inputBox button:focus,
    .inputBox button:active {
      color: #ffffff;
      outline: none;
    }
      
    #messages {
      color: slateblue;
      font-family: 'Iosevka Term';
      font-weight: 800;
      font-size: 24px;
      position: absolute;
      bottom: 4em;
      width: 100%;
      text-transform: uppercase;
      text-align: center;
    }

  </style>
</head>

<body id="body">
<div>

  <div class="inputBox">

      <img src="arch.png"/>
      
      <input 
        id="uname" 
        type="text"
        placeholder="username" />

      <input 
        id="pword" 
        type="password"
        placeholder="" />

      <button
        id="loginbtn">
        < Login >
      <button />

  </div>

  <div class="messageBox" id="messages"></div>

</div>
<script>

  // const $ = (selector) => document.querySelector(selector).bind(document);
  async function main() {

    window.show_error = function (msg) {
        document.querySelector('#messages').style.color = 'red';
        document.querySelector('#messages').innerHTML = msg;
    }

    window.show_message = function (msg) {
        document.querySelector('#messages').style.color = 'slateblue';
        document.querySelector('#messages').innerHTML = msg;
    }

    window.show_prompt = function () {}

    window.shutdown = function () {
      lightdm.shutdown();
    }

    submit = async function () {
      let uname = document.querySelector('#uname').value;
      let pword = document.querySelector('#pword').value;
      
      lightdm.cancel_authentication();
      lightdm.authenticate(uname);
      setTimeout(() => lightdm.respond(pword, 500);
    }

    window.authentication_complete = function () {
      if (lightdm.is_authenticated) {
        document.querySelector('#uname').style.opacity = 0;
        document.querySelector('#pword').style.opacity = 0;
        document.querySelector('#loginbtn').style.opacity = 0;
        let session = lightdm.sessions[0].name || 'i3';
        document.documentElement.addEventListener('transitionend', () => lightdm.start_session(session));
      } else {
        show_error("Wrong Password!");
      }
    }

    window.autologin_timer_expired = function (username) {}

    document.querySelector('#uname').value = 'bjarke'; 
    document.querySelector('#pword').focus();
    document.querySelector('#loginbtn').addEventListener('click', submit);

    lightdm.show_message.connect(window.show_message);
    lightdm.show_prompt.connect(window.show_prompt);
    lightdm.authentication_complete.connect(window.authentication_complete);
    lightdm.autologin_timer_expired.connect(window.autologin_timer_expired);

    document.querySelector('#pword').addEventListener('keydown', (e) => {
      if (e.key == 'Enter') {
          e.preventDefault();
          e.stopImmediatePropagation();
          submit();
      } else {
      }
    });
  }

  window.addEventListener('GreeterReady', () => setTimeout(main, 200));

</script>

</body>

</html>
