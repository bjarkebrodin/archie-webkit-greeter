<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">

<html>
<head>
  <meta charset="UTF-8">
  <style>

    html, body {
      background-image: url('/usr/share/backgrounds/greeter/default.jpg');
      background-position: center;
      background-size: cover;
    }

    html, body {
      width: 100%;
      height: 100%;
      overflow: hidden;
      margin: 0;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .inputBox {
      width: 180px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
    }

    .inputBox * {
      transition: 1s all;
    }

    .inputBox img {
      margin-bottom: 3em;
    }
    
    .inputBox input,
    .inputBox button {
      border: none;
      background-color: transparent;
      color: #dddddd;
      font-family: 'Iosevka Term';
      font-size: 18px;
      text-align: center;
      margin-bottom: 1em;
    }

    .inputBox button {
      margin-top: 2em;
      color: transparent;
    }

    .inputBox input:active,
    .inputBox input:focus,
    .inputBox input::selection,
    .inputBox button:focus,
    .inputBox button:active {
      color: #ffffff;
      outline: none;
    }
      
    #messages {
      color: slateblue;
      font-family: 'Iosevka Term';
      font-size: 18px;
      position: absolute;
      bottom: 4em;
      width: 100%;
      text-transform: uppercase;
      text-align: center;
    }

  </style>
</head>

<body id="body">
<div>

  <div class="inputBox">

      <img src="arch.png"/>
      
      <input 
        id="uname" 
        type="text"
        placeholder="username" />

      <input 
        id="pword" 
        type="password"
        placeholder="password" />

      <button
        id="loginbtn"
        onclick="javascript:submit();" >
        < GO >
      <button />

  </div>

  <div class="messageBox" id="messages"></div>

</div>
<script>

  // const $ = (selector) => document.querySelector(selector).bind(document);

  window.show_error = function (msg)
  {
      document.querySelector('#messages').style.color = 'red';
      document.querySelector('#messages').innerHTML = msg;
  }

  window.show_message = function (msg) {
      document.querySelector('#messages').style.color = 'slateblue';
      document.querySelector('#messages').innerHTML = msg;
  }

  window.show_prompt = function () {

  }

  window.shutdown = function ()
  {
    lightdm.shutdown();
  }

  window.submit = function ()
  {
    let uname = document.querySelector('#uname').value;
    let pword = document.querySelector('#pword').value;
    
    lightdm.authenticate(uname);
    setTimeout(() => lightdm.respond(pword), 200);
  }

  window.authentication_complete = function () 
  {
    if (lightdm.is_authenticated) {
      document.documentElement.addEventListener('transitioned', transition);
    } else {
      show_message("Wrong Password!");
      setTimeout(start_authentication, 2000);
    }
  }

  window.autologin_timer_expired = function (username) {}

  function transition() 
  {
    document.querySelector('#uname').style.display = 'none';
    document.querySelector('#pword').style.display = 'none';
    document.querySelector('#loginbtn').style.display = 'none';
    lightdm.start_session('i3');
  }

  window.addEventListener('GreeterReady', ((e) => {
    document.querySelector('#uname').value = 'bjarke'; 
    document.querySelector('#pword').focus();
    lightdm.show_message.connect(show_message);
    lightdm.show_prompt.connect(show_prompt);
    lightdm.authentication_complete.connect(authentication_complete);
    lightdm.autologin_timer_expired.connect(autologin_timer_expired);
  }).bind(document));

</script>

</body>
</html>
